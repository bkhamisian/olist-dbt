version: 2

semantic_models:
  - name: customers_semantic_model
    model: ref('marts_customers')
    description: "Semantic model for customer data, including order statistics."
    defaults:
      agg_time_dimension: first_order_date
    entities:
      - name: customer
        expr: customer_unique_id
        type: primary
        description: "Unique identifier for each customer."
    measures:
      - name: total_orders
        description: "Total number of orders placed by the customer."
        expr: "total_orders"
        agg: sum
      - name: total_spent
        description: "Total amount spent by the customer."
        expr: "total_spent"
        agg: sum
      - name: avg_delivery_time
        description: "Average delivery time for the customer's orders."
        expr: avg_delivery_time
        agg: average
    dimensions:
      - name: first_order_date
        description: "Date of the customer's first order."
        type: time
        type_params:
          time_granularity: day
      - name: has_more_than_ten_orders
        description: "Flag: Set to True if the total number of orders exceeds 10. Otherwise, it is set to False."
        type: categorical
        expr: case when total_orders > 10 then true else false end


#    measures:
#      - name: count_lifetime_orders
#        description: Total count of orders per customer.
#        agg: sum
#        expr: number_of_orders
#      - name: lifetime_spend
#        agg: sum
#        expr: lifetime_value
#        description: Gross customer lifetime spend inclusive of taxes.
#      - name: customers
#        expr: customer_id
#        agg: count_distinct

metrics:
  - name: total_orders
    description: "Total number of orders placed by customers."
    label:  "Total Orders"
    type: simple
    type_params:
      measure: total_orders
  - name: total_spent
    description: "Total amount spent by customers."
    label: "Total Spent"
    type: simple
    type_params:
      measure: total_spent
  - name: avg_delivery_time
    description: "Average delivery time for customer orders."
    label: "Average Delivery Time"
    type: simple
    type_params:
      measure: avg_delivery_time